<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:Orm.Toolkit"
                    xmlns:converters="clr-namespace:Orm.Toolkit.Core.Converters">

    <Color x:Key="BlackColor">
        #FFFFFFFF
    </Color>
    <SolidColorBrush x:Key="BlackBrush" SolidColorBrush.Color="{StaticResource BlackColor}"/>

    <Color x:Key="AccentColor">
        #2D2D30
    </Color>
    
    <Color x:Key="AccentColor3">
        #66F0A30A
    </Color>

    <Color x:Key="Gray7">
        #FF7E7E7E
    </Color>


    <SolidColorBrush x:Key="AccentColorBrush" SolidColorBrush.Color="{StaticResource AccentColor}"/>
    <SolidColorBrush x:Key="AccentColorBrush3" SolidColorBrush.Color="{StaticResource AccentColor3}" />
    <SolidColorBrush x:Key="GrayBrush7" SolidColorBrush.Color="{StaticResource Gray7}" />

    <converters:FileSizeConverter x:Key="FileSizeConverter" />
    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    
    <Style x:Key="LinkButtonStyle" TargetType="{x:Type Button}">
        <Setter Property="Cursor" Value="Hand"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Button}">
                    <TextBlock 
                        Text="{TemplateBinding Content}" 
                        TextTrimming="CharacterEllipsis"/>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Style.Triggers>
            <Trigger Property="IsMouseOver" Value="true">
                <Setter Property="Foreground" Value="{DynamicResource HighlightBrush}"/>
            </Trigger>
        </Style.Triggers>
    </Style>

    <Style x:Key="MetroCircleButtonFocusVisual">
        <Setter Setter.Property="Control.Template">
            <Setter.Value>
                <ControlTemplate ControlTemplate.TargetType="{x:Type Control}">
                    <Ellipse FrameworkElement.Margin="8" Shape.Stroke="{StaticResource BlackBrush}" Shape.StrokeDashArray="2 2" Shape.StrokeThickness="1" UIElement.SnapsToDevicePixels="True" />
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>


    <Style x:Key="MetroCircleButtonStyle" Style.TargetType="{x:Type Button}">
        <Setter Setter.Property="FrameworkElement.FocusVisualStyle" Setter.Value="{StaticResource MetroCircleButtonFocusVisual}" />
        <Setter Setter.Property="Control.Background" Setter.Value="#00FFFFFF" />
        <Setter Setter.Property="Control.BorderThickness" Setter.Value="2" />
        <Setter Setter.Property="Control.HorizontalContentAlignment" Setter.Value="Center" />
        <Setter Setter.Property="Control.VerticalContentAlignment" Setter.Value="Center" />
        <Setter Setter.Property="Control.Padding" Setter.Value="1" />
        <Setter Setter.Property="Control.Template">
            <Setter.Value>
                <ControlTemplate ControlTemplate.TargetType="{x:Type Button}">
                    <Grid>
                        <Ellipse Shape.Fill="{TemplateBinding Control.Background}" FrameworkElement.Margin="4" Shape.StrokeThickness="0" />
                        <Ellipse Ellipse.Name="ellipsebg" Shape.Fill="{StaticResource BlackBrush}" UIElement.Opacity="0" FrameworkElement.Margin="4" Shape.StrokeThickness="0" />
                        <Ellipse Ellipse.Name="ellipse" FrameworkElement.Margin="4" Shape.Stroke="{TemplateBinding Control.Foreground}" Shape.StrokeThickness="{Binding RelativeSource={x:Static RelativeSource.TemplatedParent},Path=BorderThickness.Left}" />
                        <ContentPresenter ContentPresenter.Name="content" FrameworkElement.HorizontalAlignment="{TemplateBinding Control.HorizontalContentAlignment}" FrameworkElement.Margin="{TemplateBinding Control.Padding}" ContentPresenter.RecognizesAccessKey="True" UIElement.SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" FrameworkElement.VerticalAlignment="{TemplateBinding Control.VerticalContentAlignment}" />
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Trigger.Property="ButtonBase.IsPressed" Trigger.Value="True">
                            <TriggerBase.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="ellipsebg" Storyboard.TargetProperty="Opacity" DoubleAnimation.From="0" DoubleAnimation.To="0.3" Timeline.Duration="0:0:0" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </TriggerBase.EnterActions>
                            <TriggerBase.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="ellipsebg" Storyboard.TargetProperty="Opacity" DoubleAnimation.To="0" Timeline.Duration="0:0:0.5" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </TriggerBase.ExitActions>
                        </Trigger>
                        <Trigger Trigger.Property="UIElement.IsMouseOver" Trigger.Value="True">
                            <Setter Setter.TargetName="ellipse" Setter.Property="UIElement.Opacity" Setter.Value="1" />
                        </Trigger>
                        <Trigger Trigger.Property="UIElement.IsMouseOver" Trigger.Value="False">
                            <Setter Setter.TargetName="ellipse" Setter.Property="UIElement.Opacity" Setter.Value=".5" />
                        </Trigger>
                        <Trigger Trigger.Property="UIElement.IsEnabled" Trigger.Value="False">
                            <Setter Setter.Property="Control.Foreground" Setter.Value="#FFADADAD" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Canvas 
        x:Key="appbar_control_stop" 
        x:Shared="False" 
        Width="48" 
        Height="48" 
        Clip="F1 M 0,0L 48,0L 48,48L 0,48L 0,0" 
        UseLayoutRounding="False">
        <Path 
            Width="38" 
            Height="6" 
            Canvas.Left="19" 
            Canvas.Top="38" 
            Stretch="Fill" 
            Fill="{StaticResource BlackBrush}" 
            Data="F1 M 19,38L 57,38L 57,44L 19,44L 19,38 Z "/>
    </Canvas>

    <Canvas x:Key="appbar_folder_open" FrameworkElement.Width="48" FrameworkElement.Height="48" UIElement.Clip="F1M0,0L48,0 48,48 0,48 0,0" FrameworkElement.UseLayoutRounding="False">
        <Path FrameworkElement.Width="26.5833" FrameworkElement.Height="19" Canvas.Left="13" Canvas.Top="13" Shape.Stretch="Fill" Shape.Fill="{StaticResource BlackBrush}" Path.Data="F1M16.6668,20L13,28.5336 13,16 23,16 23,15C23,13.8954,23.8954,13,25,13L32,13C33.1046,13,35,14.8954,35,16L35,20 16.6668,20z M35,32L28,32 13,32 17.5833,21 39.5833,21 35,32z" />
    </Canvas>

    <Canvas x:Key="appbar_play" FrameworkElement.Width="48" FrameworkElement.Height="48" UIElement.Clip="F1M0,0L48,0 48,48 0,48 0,0" FrameworkElement.UseLayoutRounding="False">
        <Path                              Width="16.3452"
                              Height="18.561"
                              Stretch="Fill"
                              Data="F1 M 312.65,425.66C 312.65,426.616 312.62,438.328 312.62,439.822C 312.62,441.465 313.408,441.957 314.752,441.211C 316.097,440.465 325.459,435.021 326.655,434.275C 327.85,433.529 328.002,432.087 326.814,431.381C 325.505,430.603 315.863,425.264 314.633,424.589C 313.344,423.882 312.65,424.703 312.65,425.66 Z "
                              RenderTransformOrigin="0.5,0.5"
                              Canvas.Left="12.5"
                              Canvas.Top="9.5"
                              Stroke="White"
                              Shape.Fill="{StaticResource BlackBrush}"
                              IsHitTestVisible="False">
            <Path.RenderTransform>
                <TransformGroup>
                    <ScaleTransform ScaleX="1"
                                                    ScaleY="1" />
                    <SkewTransform AngleX="0"
                                                   AngleY="0" />
                    <RotateTransform Angle="0" />
                    <TranslateTransform X="0"
                                                        Y="0" />
                </TransformGroup>
            </Path.RenderTransform>
        </Path>
    </Canvas>

    <Canvas x:Key="appbar_pause" FrameworkElement.Width="48" FrameworkElement.Height="48" UIElement.Clip="F1M0,0L48,0 48,48 0,48 0,0" FrameworkElement.UseLayoutRounding="False">
        <Path Width="5.66733"
                                  Height="19.6623"
                                  Canvas.Left="12.124"
                                  Canvas.Top="8.932"
                                  Stretch="Fill"
                                  StrokeThickness="1"
                                  StrokeLineJoin="Round"
                                  Data="F1 M 317.312,440.332C 317.312,441.27 316.342,442.029 315.146,442.029C 313.948,442.029 312.978,441.27 312.978,440.332L 312.978,425.398C 312.978,424.46 313.948,423.7 315.146,423.7C 316.342,423.7 317.312,424.46 317.312,425.398L 317.312,440.332 Z "
                                  RenderTransformOrigin="0.5,0.5"
                                   Stroke="White"
                              Shape.Fill="{StaticResource BlackBrush}">
            <Path.RenderTransform>
                <TransformGroup>
                    <ScaleTransform ScaleX="1"
                                                        ScaleY="1" />
                    <SkewTransform AngleX="0"
                                                       AngleY="0" />
                    <RotateTransform Angle="0" />
                    <TranslateTransform X="0"
                                                            Y="0" />
                </TransformGroup>
            </Path.RenderTransform>
        </Path>
        <Path Width="5.66733"
                                  Height="19.6623"
                                  Stretch="Fill"
                                  StrokeThickness="1"
                                  StrokeLineJoin="Round"
                                  Data="F1 M 317.312,440.332C 317.312,441.27 316.342,442.029 315.146,442.029C 313.948,442.029 312.978,441.27 312.978,440.332L 312.978,425.398C 312.978,424.46 313.948,423.7 315.146,423.7C 316.342,423.7 317.312,424.46 317.312,425.398L 317.312,440.332 Z "
                                  RenderTransformOrigin="0.5,0.5"
                                  Canvas.Left="19.728"
                                  Canvas.Top="8.932"
                                  Stroke="White"
                                  Shape.Fill="{StaticResource BlackBrush}">
            <Path.RenderTransform>
                <TransformGroup>
                    <ScaleTransform ScaleX="1"
                                                        ScaleY="1" />
                    <SkewTransform AngleX="0"
                                                       AngleY="0" />
                    <RotateTransform Angle="0" />
                    <TranslateTransform X="0"
                                                            Y="0" />
                </TransformGroup>
            </Path.RenderTransform>
        </Path>
    </Canvas>

    <Canvas 
        x:Key="appbar_minus" 
        x:Shared="False" 
        Width="48" 
        Height="48" 
        Clip="F1 M 0,0L 48,0L 48,48L 0,48L 0,0" 
        UseLayoutRounding="False">
        <Path 
            Width="38" 
            Height="6" 
            Canvas.Left="19" 
            Canvas.Top="38" 
            Stretch="Fill" 
            Fill="#FFFFFF" 
            Data="F1 M 19,38L 57,38L 57,44L 19,44L 19,38 Z "/>
    </Canvas>


    <Canvas 
        x:Key="appbar_minus_disabled"
        x:Shared="False"
        Width="48" 
        Height="48" 
        Clip="F1 M 0,0L 48,0L 48,48L 0,48L 0,0" 
        UseLayoutRounding="False">
        <Path 
            Width="38" 
            Height="6" 
            Canvas.Left="19" 
            Canvas.Top="38" 
            Stretch="Fill" 
            Fill="#ADADAD" 
            Data="F1 M 19,38L 57,38L 57,44L 19,44L 19,38 Z "/>
    </Canvas>

    
    

    <Style x:Key="CancelButtonStyle" TargetType="{x:Type Button}" BasedOn="{StaticResource MetroCircleButtonStyle}">
        <Style.Triggers>
            <DataTrigger Binding="{Binding IsCanceled}" Value="True">
                <Setter Property="Content">
                    <Setter.Value>
                        <Rectangle Width="16" Height="16">
                            <Rectangle.Fill>
                                <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_minus_disabled}" />
                            </Rectangle.Fill>
                        </Rectangle>
                    </Setter.Value>
                </Setter>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <DrawingImage x:Key="FileImage">
        <DrawingImage.Drawing>
            <DrawingGroup>
                <DrawingGroup.Children>
                    <DrawingGroup ClipGeometry="F1 M 0,74.6667L 51.2956,74.6667L 51.2956,0.072937L 0,0.072937L 0,74.6667 Z ">
                        <DrawingGroup.Children>
                            <GeometryDrawing Geometry="F1 M 40.5853,16.796C 42.4627,14.5413 46.036,14.1653 51.108,15.4787L 51.108,15.4787C 47.1613,9.28 41.9013,4.20667 35.7,0.0733337L 35.7,0.0733337M 0,0.259995L 0,74.6667L 51.2947,74.6667L 51.2947,19.0493L 50.92,19.0493C 45.0947,17.1707 41.5253,17.7333 40.3987,21.116L 40.3987,21.116C 40.3987,21.3053 40.2093,21.4933 40.0227,21.68L 40.0227,21.68C 39.6453,21.8693 39.6453,21.8693 39.2707,21.8693L 39.2707,21.8693C 39.0813,21.8693 38.7053,21.8693 38.7053,21.68L 38.7053,21.68C 38.52,21.4933 38.3307,21.3053 38.3307,21.116L 32.3173,0.824005C 32.1307,0.636002 32.1307,0.447998 32.3173,0.259995M 4.88533,21.4933C 4.50933,21.116 4.32133,20.7413 4.32133,20.3653L 4.32133,20.3653C 4.32133,19.8027 4.50933,19.4253 4.88533,19.0493L 4.88533,19.0493C 5.072,18.8613 5.44933,18.6747 6.012,18.6747L 28.3733,18.6747C 28.7467,18.6747 29.124,18.8613 29.5,19.0493L 29.5,19.0493C 29.8747,19.4253 30.064,19.8027 30.064,20.3653L 30.064,20.3653C 30.064,20.7413 29.8747,21.116 29.5,21.4933L 29.5,21.4933C 29.124,21.68 28.7467,21.8693 28.3733,22.056L 6.012,22.056C 5.636,21.8693 5.072,21.68 4.88533,21.4933 Z M 5.44933,30.512C 5.072,30.1373 4.88533,29.76 4.88533,29.384L 4.88533,29.384C 4.88533,28.82 5.072,28.444 5.44933,28.2573L 5.44933,28.2573C 5.82533,27.8813 6.2,27.6933 6.57733,27.6933L 37.0147,27.6933C 37.5787,27.6933 37.7667,27.8813 38.3307,28.0693L 38.3307,28.0693C 38.52,28.444 38.7053,28.82 38.7053,29.384L 38.7053,29.384C 38.7053,29.76 38.52,30.1373 38.3307,30.512L 38.3307,30.512C 37.9547,30.6987 37.5787,30.888 37.204,31.076L 6.764,31.076C 6.2,30.888 5.82533,30.6987 5.44933,30.512 Z M 5.44933,39.5307C 5.26133,39.1547 5.072,38.7787 5.072,38.404L 5.072,38.404C 5.072,37.84 5.26133,37.4627 5.44933,37.088L 5.44933,37.088C 5.82533,36.9 6.2,36.712 6.57733,36.712L 37.204,36.712C 37.5787,36.712 37.9547,36.9 38.3307,37.088L 38.3307,37.088C 38.52,37.4627 38.7053,37.84 38.7053,38.404L 38.7053,38.404C 38.7053,38.7787 38.52,39.1547 38.3307,39.5307L 38.3307,39.5307C 37.9547,39.9067 37.5787,40.0947 37.204,40.0947L 6.764,40.0947C 6.2,39.9067 5.82533,39.7187 5.44933,39.5307 Z M 5.44933,48.5493C 5.072,48.1733 4.88533,47.7987 4.88533,47.4213L 4.88533,47.4213C 4.88533,46.8587 5.072,46.484 5.44933,46.108L 5.44933,46.108C 5.82533,45.92 6.2,45.732 6.764,45.732L 37.204,45.732C 37.5787,45.732 37.9547,45.92 38.3307,46.2933L 38.3307,46.2933C 38.52,46.484 38.7053,46.8587 38.7053,47.4213L 38.7053,47.4213C 38.7053,47.7987 38.52,48.1733 38.3307,48.5493L 38.3307,48.5493C 37.9547,48.7387 37.5787,48.9253 37.0147,49.1133L 6.57733,49.1133C 6.2,48.9253 5.82533,48.7387 5.44933,48.5493 Z M 5.44933,57.5693C 5.072,57.192 4.88533,56.8173 5.072,56.4413L 5.072,56.4413C 4.88533,55.8773 5.072,55.5027 5.44933,55.1253L 5.44933,55.1253C 5.82533,54.9373 6.2,54.7507 6.57733,54.7507L 37.0147,54.7507C 37.5787,54.7507 37.7667,54.9373 38.3307,55.1253L 38.3307,55.1253C 38.52,55.5027 38.7053,55.8773 38.7053,56.4413L 38.7053,56.4413C 38.7053,56.8173 38.52,57.192 38.3307,57.5693L 38.3307,57.5693C 37.7667,57.944 37.5787,58.1333 37.0147,58.1333L 6.764,58.1333C 6.2,57.944 5.82533,57.756 5.44933,57.5693 Z ">
                                <GeometryDrawing.Brush>
                                    <LinearGradientBrush StartPoint="0.501392,-0.00291191" EndPoint="0.501392,0.997093">
                                        <LinearGradientBrush.GradientStops>
                                            <GradientStop Color="#FFFCE040" Offset="0"/>
                                            <GradientStop Color="#FFFCE040" Offset="0.00561523"/>
                                            <GradientStop Color="#FFFAC132" Offset="0.507205"/>
                                            <GradientStop Color="#FFF9A224" Offset="1"/>
                                        </LinearGradientBrush.GradientStops>
                                    </LinearGradientBrush>
                                </GeometryDrawing.Brush>
                            </GeometryDrawing>
                        </DrawingGroup.Children>
                    </DrawingGroup>
                </DrawingGroup.Children>
            </DrawingGroup>
        </DrawingImage.Drawing>
    </DrawingImage>

    <!--<ContextMenu x:Key="DownloadContextMenu" DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
        <MenuItem Command="{Binding CancelCommand}" Header="Cancel Download" Visibility="{Binding IsActive, Converter={StaticResource BooleanToVisibilityConverter}}" />
        <MenuItem Command="{Binding OpenDownloadedFileFolderCommand}" Header="Open Containing Folder" />
    </ContextMenu>

    <DataTemplate x:Key="DownloadToolTipTemplate" DataType="{x:Type local:DownloadItem}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <TextBlock 
                Text="Name: " 
                VerticalAlignment="Center" 
                HorizontalAlignment="Right"/>
            <TextBlock 
                Grid.Column="1" 
                Text="{Binding FileName}" 
                Margin="2"/>
            <TextBlock 
                Grid.Row="1" 
                Text="Size: " 
                VerticalAlignment="Center" 
                HorizontalAlignment="Right"/>
            <TextBlock 
                Grid.Column="1" 
                Grid.Row="1" 
                Text="{Binding FileSize}" 
                Margin="2"/>
            <TextBlock 
                Grid.ColumnSpan="2" 
                Grid.Row="2" 
                Margin="2,5,2,2" 
                FontStyle="Italic" 
                TextWrapping="Wrap" 
                Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" 
                Text="Right-Click for more options"/>
        </Grid>
    </DataTemplate>-->

    <!--<DataTemplate x:Key="DownloadTemplate" DataType="{x:Type local:DownloadItem}">
        <DataTemplate.Resources>
            <Storyboard x:Key="Flash">
                <DoubleAnimation 
                    Storyboard.TargetName="fileImage" 
                    Storyboard.TargetProperty="(UIElement.Opacity)" 
                    From="1" 
                    To="0" 
                    Duration="00:00:00.3" 
                    AutoReverse="True" 
                    RepeatBehavior="3x"/>
            </Storyboard>
        </DataTemplate.Resources>
        <Button 
            Command="{Binding OpenDownloadedFile}" 
            Margin="3" 
            Padding="0"
            ContextMenu="{StaticResource DownloadContextMenu}">
            <Button.ToolTip>
                <ToolTip Content="{Binding}" ContentTemplate="{StaticResource DownloadToolTipTemplate}" />
            </Button.ToolTip>
            <Grid Margin="2" VerticalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <Image 
                    x:Name="fileImage" 
                    Width="30" 
                    Height="36" 
                    Source="{StaticResource FileImage}" 
                    VerticalAlignment="Center" 
                    Visibility="Collapsed" 
                    Opacity="0"/>
                <local:CircularProgressBar 
                    x:Name="progressBar" 
                    Width="36" 
                    Height="36" 
                    Foreground="{Binding Foreground}" 
                    VerticalAlignment="Center" 
                    Value="{Binding Progress, Mode=OneWay}" 
                    StrokeThickness="5" 
                    HoleSizeFactor="0.75" 
                    TextBlock.FontSize="9"/>
                <TextBlock 
                    Grid.Column="1" 
                    Margin="3" 
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center" 
                    TextTrimming="CharacterEllipsis" 
                    MaxWidth="200" 
                    Foreground="{Binding Foreground}" 
                    Text="{Binding FileName}"/>
            </Grid>
        </Button>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding IsDownloading}" Value="False">
                <Setter TargetName="progressBar" Property="Visibility" Value="Collapsed" />
                <Setter TargetName="fileImage" Property="Visibility" Value="Visible" />
            </DataTrigger>
            <DataTrigger Binding="{Binding IsCancelled}" Value="True">
                <Setter TargetName="fileImage" Property="Opacity" Value="0.5" />
            </DataTrigger>
            <DataTrigger Binding="{Binding IsDownloadComplete}" Value="True">
                <DataTrigger.EnterActions>
                    <BeginStoryboard Storyboard="{StaticResource Flash}" />
                </DataTrigger.EnterActions>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>-->

    <!--<DataTemplate x:Key="DownloadTemplate" DataType="{x:Type local:DownloadItem}">
        <DataTemplate.Resources>
            <Storyboard x:Key="Flash">
                <DoubleAnimation 
                    Storyboard.TargetName="fileImage" 
                    Storyboard.TargetProperty="(UIElement.Opacity)" 
                    From="1" 
                    To="0" 
                    Duration="00:00:00.3" 
                    AutoReverse="True" 
                    RepeatBehavior="3x"/>
            </Storyboard>
        </DataTemplate.Resources>
        <local:SplitButton 
            x:Name="operationButton"
            ContextMenu="{StaticResource DownloadContextMenu}"
            Command="{Binding openCommand}" 
            Margin="3" 
            Padding="0"
            Height="42">
            --><!--Command="{Binding OpenDownloadedFileCommand}" 
            Visibility="{Binding OpenDownloadedFileAlwaysEnabled, Mode=OneWayToSource, Converter={StaticResource BooleanToVisibilityConverter}}"--><!--

            <local:SplitButton.Effect>
                <DropShadowEffect BlurRadius="1" ShadowDepth="0.3" />
            </local:SplitButton.Effect>
            --><!--<local:SplitButton.ButtonToolTip>
                <ToolTip Content="{Binding}" ContentTemplate="{StaticResource DownloadToolTipTemplate}" />
            </local:SplitButton.ButtonToolTip>--><!--
            <local:SplitButton.DropDownContent>
                <Border 
                    BorderThickness="1" 
                    Background="{DynamicResource ContextMenuBackgroundBrush}" 
                    BorderBrush="{DynamicResource ContextMenuBorderBrush}">
                    <StackPanel 
                        SnapsToDevicePixels="True" 
                        RenderOptions.ClearTypeHint="Enabled" 
                        TextOptions.TextFormattingMode="Ideal">
                        --><!--<StackPanel.Resources>
                            <Style BasedOn="{StaticResource MetroMenuItem}" TargetType="{x:Type MenuItem}">
                                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                <Setter Property="VerticalContentAlignment" Value="Center"/>
                                <Setter Property="FontFamily" Value="{DynamicResource {x:Static SystemFonts.MenuFontFamilyKey}}" />
                                <Setter Property="FontSize" Value="{DynamicResource ContextMenuFontSize}" />
                                <Setter Property="FontStyle" Value="{DynamicResource {x:Static SystemFonts.MenuFontStyleKey}}" />
                                <Setter Property="FontWeight" Value="{DynamicResource {x:Static SystemFonts.MenuFontWeightKey}}" />
                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}" />
                            </Style>
                        </StackPanel.Resources>--><!--
                        <MenuItem Command="{Binding CancelCommand}" Header="Cancel Download" Visibility="{Binding IsActive, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        <MenuItem Command="{Binding OpenDownloadedFileFolderCommand}" Header="Open Containing Folder" />
                    </StackPanel>
                </Border>
            </local:SplitButton.DropDownContent>
            <Grid Margin="2" VerticalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="35" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <Image 
                    x:Name="fileImage" 
                    Width="32" 
                    Height="32" 
                    Source="{Binding FileIcon}" 
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center" 
                    Visibility="Collapsed" 
                    Opacity="0"/>
                <local:CircularProgressBar 
                    x:Name="progressBar" 
                    Width="33" 
                    Height="33" 
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center" 
                    Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType={x:Type Button}}}" 
                    Value="{Binding Progress, Mode=OneWay}" 
                    StrokeThickness="5" 
                    HoleSizeFactor="0.75" 
                    TextBlock.FontSize="9"/>
                <TextBlock 
                    Grid.Column="1" 
                    Margin="2" 
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center" 
                    TextTrimming="CharacterEllipsis" 
                    MinWidth="100"
                    MaxWidth="150" 
                    Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType={x:Type Button}}}" 
                    Text="{Binding FileName}"/>
            </Grid>
        </local:SplitButton>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding IsActive}" Value="False">
                <Setter TargetName="progressBar" Property="Visibility" Value="Collapsed" />
                <Setter TargetName="fileImage" Property="Visibility" Value="Visible" />
            </DataTrigger>
            <DataTrigger Binding="{Binding IsCanceled}" Value="True">
                <Setter TargetName="fileImage" Property="Opacity" Value="0.5" />
            </DataTrigger>
            <DataTrigger Binding="{Binding IsComplete}" Value="True">
                <DataTrigger.EnterActions>
                    <BeginStoryboard Storyboard="{StaticResource Flash}" />
                </DataTrigger.EnterActions>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>-->

    <Style x:Key="DownloadsFlyoutControlItem" TargetType="{x:Type ListBoxItem}">
        <Setter Property="Background" Value="LightBlue" />
        <Setter Property="Foreground" Value="{StaticResource BlackBrush}"/>
        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        <Setter Property="VerticalContentAlignment" Value="Center"/>
        <Setter Property="MinHeight" Value="25"/>
        <Setter Property="Margin" Value="0,0,0,2"/>
        <Setter Property="SnapsToDevicePixels" Value="True"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ListBoxItem}">
                    <ControlTemplate.Resources>
                        <Style TargetType="{x:Type Canvas}">
                            <Style.Resources>
                                <Style TargetType="{x:Type Path}">
                                    <Setter Property="Fill" Value="{StaticResource BlackBrush}" />
                                </Style>
                            </Style.Resources>
                        </Style>
                    </ControlTemplate.Resources>
                    <Border 
                        x:Name="Border" 
                        Background="{TemplateBinding Background}" 
                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}">
                        <ContentPresenter 
                            Margin="5, 0, 0, 0" 
                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" 
                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Border" Property="Background" Value="{StaticResource AccentColorBrush3}"/>
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter Property="Foreground" Value="{StaticResource GrayBrush7}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Style.Triggers>
            <DataTrigger Binding="{Binding IsCanceled}" Value="True">
                <Setter Property="IsEnabled" Value="False" />
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <DataTemplate x:Key="DownloadFlyoutItem" DataType="{x:Type local:DownloadItem}">
        <DataTemplate.Resources>
            <Storyboard x:Key="Flash">
                <DoubleAnimation 
                    Storyboard.TargetName="fileImage" 
                    Storyboard.TargetProperty="(UIElement.Opacity)" 
                    From="1" 
                    To="0" 
                    Duration="00:00:00.3" 
                    AutoReverse="True" 
                    RepeatBehavior="3x"/>
            </Storyboard>
        </DataTemplate.Resources>
        <Grid Margin="-5,0,0,0" SnapsToDevicePixels="True">
            <Grid.RowDefinitions>
                <RowDefinition Height="65" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="65" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Image 
                x:Name="fileImage" 
                Width="48" 
                Height="48" 
                Stretch="None"
                SnapsToDevicePixels="True"
                Source="{StaticResource FileImage}"    
                HorizontalAlignment="Center" 
                VerticalAlignment="Center" 
                Visibility="Collapsed" 
                Opacity="0"/>
            <!--Source="{Binding FileLargeIcon}"-->
            <local:ProgressRing 
                x:Name="progressRing"
                Width="48" 
                Height="48" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Center"
                IsActive="{Binding IsDownloading, Mode=OneWay,UpdateSourceTrigger=PropertyChanged}"/> <!--IsActive="{Binding IsActive, Mode=OneWay}-->
            <TextBlock 
                x:Name="progressText"
                Foreground="{StaticResource AccentColorBrush}"
                HorizontalAlignment="Center" 
                VerticalAlignment="Center" 
                FontSize="12"
                Text="{Binding Progress,Mode=OneWay,UpdateSourceTrigger=PropertyChanged,StringFormat={}{0}%}"/>
            <Grid Grid.Column="1" Margin="5" >
                <Grid.RowDefinitions>
                    <RowDefinition />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto" MinWidth="60" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="auto" MinWidth="30" />
                    <ColumnDefinition Width="auto" MinWidth="120" />
                </Grid.ColumnDefinitions>
                <TextBlock 
                    x:Name="fileTextBlock"
                    Grid.ColumnSpan="4"
                    HorizontalAlignment="Left" 
                    VerticalAlignment="Center" 
                    TextTrimming="CharacterEllipsis" 
                    FontSize="14" 
                    MaxWidth="250" 
                    Margin="3"
                    ToolTip="{Binding FileName,Mode=OneWay,UpdateSourceTrigger=PropertyChanged}" 
                    Text="{Binding FileName,Mode=OneWay,UpdateSourceTrigger=PropertyChanged}"/>
                <Button 
                    x:Name="openButton" 
                    Grid.ColumnSpan="4"
                    HorizontalAlignment="Left" 
                    VerticalAlignment="Center" 
                    FontSize="14" 
                    MaxWidth="250" 
                    Margin="3"
                    Command="{Binding OpenDownloadedFileCommand}" 
                    ToolTip="打开" 
                    Content="{Binding FileName,Mode=OneWay,UpdateSourceTrigger=PropertyChanged}" 
                    Style="{StaticResource LinkButtonStyle}" 
                    Visibility="Collapsed"/>
                <TextBlock 
                    Grid.Row="1" 
                    Grid.Column="0"
                    Margin="1,2"
                    Opacity="0.5"
                    FontSize="12"
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Left">
                    <Run  Foreground="{StaticResource AccentColorBrush}" Text="{Binding DownloadBytes,Mode=OneWay,UpdateSourceTrigger=PropertyChanged,Converter={StaticResource FileSizeConverter}}" />
                    <Run Text="/" />
                </TextBlock>
                <TextBlock 
                    Grid.Column="1" 
                    Grid.Row="1" 
                    Foreground="{StaticResource AccentColorBrush}"
                    Margin="1,2"
                    Opacity="0.5"
                    FontSize="12"
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Left"
                    Text="{Binding TotalBytes,Mode=OneWay,Converter={StaticResource FileSizeConverter},UpdateSourceTrigger=PropertyChanged}" />
                <TextBlock 
                    x:Name="speedLabel" 
                    Foreground="{StaticResource AccentColorBrush}"
                    Grid.Column="2"
                    Grid.Row="2" 
                    FontSize="12"
                    Text="速度: " 
                    Margin="5,2,2,2"
                    Opacity="0.5"
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Left"/>
                <TextBlock 
                    x:Name="speedBox" 
                    Foreground="{StaticResource AccentColorBrush}"
                    Grid.Column="3" 
                    Grid.Row="2" 
                    Margin="1,2"
                    Opacity="0.5"
                    FontSize="12"
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Left"
                    Text="{Binding CurrentSpeed,Mode=OneWay,Converter={StaticResource FileSizeConverter},UpdateSourceTrigger=PropertyChanged, StringFormat={}{0}/s}" />
            </Grid>  
            <StackPanel Grid.Column="1" Grid.ColumnSpan="5" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,5,0" Orientation="Horizontal">
                <Grid>
                    <Button 
                x:Name="openFolderButton"
                Grid.Column="2" 
                Margin="5,5,0,0" 
                Width="35" 
                Height="35" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Center" 
                VerticalContentAlignment="Center"
                HorizontalContentAlignment="Center"
                Command="{Binding OpenDownloadedFileFolderCommand}" 
                Style="{StaticResource MetroCircleButtonStyle}"
                Visibility="Collapsed">
                        <Rectangle Width="14" Height="14">
                            <Rectangle.Fill>
                                <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_folder_open}" />
                            </Rectangle.Fill>
                        </Rectangle>
                    </Button>
                    <Button x:Name="startButton"
                Grid.Column="2" 
                Margin="5,5,0,0" 
                Width="35" 
                Height="35" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Center" 
                VerticalContentAlignment="Center"
                HorizontalContentAlignment="Center"
                Command="{Binding StartCommand}" 
                Style="{StaticResource MetroCircleButtonStyle}" Visibility="Collapsed">
                        <Rectangle Width="14" Height="14">
                            <Rectangle.Fill>
                                <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_play}" />
                            </Rectangle.Fill>
                        </Rectangle>
                    </Button>
                    <Button x:Name="pauseButton"
                Grid.Column="2" 
                Margin="5,5,0,0" 
                Width="35" 
                Height="35" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Center" 
                VerticalContentAlignment="Center"
                HorizontalContentAlignment="Center"
                Command="{Binding PauseCommand}" 
                Style="{StaticResource MetroCircleButtonStyle}">
                        <Rectangle Width="14" Height="14">
                            <Rectangle.Fill>
                                <VisualBrush Stretch="Fill" Visual="{StaticResource  appbar_pause}" />
                            </Rectangle.Fill>
                        </Rectangle>
                    </Button>
                </Grid>
                <Grid>
                    <Button
                x:Name="cancelButton"
                Grid.Column="3" 
                Margin="5,5,0,0" 
                Width="35" 
                Height="35" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Center" 
                VerticalContentAlignment="Center"
                HorizontalContentAlignment="Center"
                Command="{Binding CancelCommand}" 
                Style="{StaticResource CancelButtonStyle}">
                        <Rectangle Width="14" Height="14">
                            <Rectangle.Fill>
                                <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_control_stop}" />
                            </Rectangle.Fill>
                        </Rectangle>
                    </Button>
                    <Button 
                x:Name="removeButton"
                Grid.Column="3" 
                Margin="5,5,0,0" 
                Width="35" 
                Height="35" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Center" 
                VerticalContentAlignment="Center"
                Command="{Binding RemoveCommand}" 
                Style="{StaticResource MetroCircleButtonStyle}"
                Background="Red"
                Visibility="Collapsed">
                        <Rectangle Width="16" Height="4">
                            <Rectangle.Fill>
                                <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_minus}" />
                            </Rectangle.Fill>
                        </Rectangle>
                    </Button>
                </Grid>
            </StackPanel>      
            <local:MetroProgressBar 
                x:Name="progressBar" 
                Grid.Row="1" 
                Grid.ColumnSpan="5" 
                Value="{Binding Progress,Mode=OneWay,UpdateSourceTrigger=PropertyChanged}" 
                Minimum="0" 
                Maximum="100" 
                Background="{Binding Background, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" 
                Foreground="{StaticResource AccentColorBrush}"
                MinHeight="2"/>
        </Grid>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding IsDownloading}" Value="False">
                <Setter TargetName="progressRing" Property="Visibility" Value="Hidden" />
                <Setter TargetName="progressText" Property="Visibility" Value="Collapsed" />
                <Setter TargetName="fileImage" Property="Visibility" Value="Visible" />
                <Setter TargetName="progressBar" Property="Visibility" Value="Hidden" />
                <Setter TargetName="speedLabel" Property="Visibility" Value="Hidden" />
                <Setter TargetName="speedBox" Property="Visibility" Value="Hidden" />
                
            </DataTrigger>
            <DataTrigger Binding="{Binding IsCanceled}" Value="True">
                <Setter TargetName="fileImage" Property="Opacity" Value="0.5" />
                <Setter TargetName="cancelButton" Property="Visibility" Value="Collapsed" />
                <Setter TargetName="removeButton" Property="Visibility" Value="Visible" />

                <Setter TargetName="startButton" Property="Visibility" Value="Collapsed" />
                <Setter TargetName="openFolderButton" Property="Visibility" Value="Collapsed" />
            </DataTrigger>
            <DataTrigger Binding="{Binding IsComplete}" Value="True">
                <Setter TargetName="fileTextBlock" Property="Visibility" Value="Collapsed" />
                <Setter TargetName="cancelButton" Property="Visibility" Value="Collapsed" />
                <Setter TargetName="openButton" Property="Visibility" Value="Visible" />
                <Setter TargetName="openFolderButton" Property="Visibility" Value="Visible" />
                <Setter TargetName="removeButton" Property="Visibility" Value="Visible" />
                <Setter TargetName="pauseButton" Property="Visibility" Value="Collapsed" />
                <DataTrigger.EnterActions>
                    <BeginStoryboard Storyboard="{StaticResource Flash}" />
                </DataTrigger.EnterActions>
            </DataTrigger>
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding IsDownloading}" Value="False" />
                    <Condition Binding="{Binding IsComplete}" Value="False" />
                </MultiDataTrigger.Conditions>
                <Setter TargetName="startButton" Property="Visibility" Value="Visible" />
                <Setter TargetName="pauseButton" Property="Visibility" Value="Collapsed" />
            </MultiDataTrigger>
            
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding IsDownloading}" Value="True" />
                    <Condition Binding="{Binding TotalBytes}" Value="0" />
                </MultiDataTrigger.Conditions>
                <Setter TargetName="progressBar" Property="IsIndeterminate" Value="True" />
                <Setter TargetName="progressText" Property="Visibility" Value="Collapsed" />
            </MultiDataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <!--<Style TargetType="{x:Type local:DownloadsFlyoutControl}" BasedOn="{StaticResource MetroListBox}">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Hidden" />
        <Setter Property="ItemContainerStyle" Value="{StaticResource DownloadsFlyoutControlItem}" />
        <Setter Property="ItemTemplate" Value="{StaticResource DownloadFlyoutItem}" />
    </Style>-->


    <Style TargetType="{x:Type local:DownloadsControl}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:DownloadsControl}">
                    <Border 
                        Background="{TemplateBinding Background}" 
                        BorderBrush="{TemplateBinding BorderBrush}" 
                        BorderThickness="{TemplateBinding BorderThickness}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <ListBox 
                                DataContext="{TemplateBinding Source}" 
                                ItemsSource="{Binding}"
                                ItemContainerStyle="{StaticResource DownloadsFlyoutControlItem}"
                                ItemTemplate="{StaticResource DownloadFlyoutItem}"
                               >
                                
                                <!--<ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>-->
                            </ListBox>
                            <!--<Button 
                                Grid.Column="2" 
                                Margin="3" 
                                Width="30" 
                                Height="30" 
                                HorizontalAlignment="Center" 
                                VerticalAlignment="Center" 
                                Command="Close" 
                                CommandParameter="Downloads" 
                                CommandTarget="{Binding RelativeSource={RelativeSource TemplatedParent}}" 
                                Padding="0">
                                <Path 
                                    Stretch="None" 
                                    Width="10" 
                                    Height="10" 
                                    HorizontalAlignment="Center" 
                                    VerticalAlignment="Center" 
                                    Stroke="Black" 
                                    Fill="Black" 
                                    StrokeThickness="3"
                                    StrokeStartLineCap="Round"
                                    StrokeEndLineCap="Round"
                                    StrokeLineJoin="Round"
                                    Data="M 0,0 L 10,10 Z M 10,0 L 0,10 Z"/>
                            </Button>-->
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>